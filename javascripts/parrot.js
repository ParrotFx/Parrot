var Locals=function(){function n(n){this._host=n,this._locals=this._host.__locals!=undefined&&this._host.__locals!=null?this._host.__locals:[]}return n.prototype.push=function(n){this._locals.push(n),this._host.__locals=this._locals},n.prototype.pop=function(){},n}()
var ObjectModelValueProvider=function(){function n(){this.valueTypeProvider=new ValueTypeProvider}return n.prototype.getValue=function(n,t,i,r){var f=i,e,u;f==null&&(e=this.getValueType(r),r=e.property,f=e.type);switch(f){case ValueType.stringLiteral:case ValueType.keyword:return{value:r,result:!0};case ValueType.local:return{value:t,result:!0};case ValueType.property:if(t!=null&&(u=this.getModelProperty(t,r),u.result==!0)||n!=null&&(u=this.getModelProperty(n,r),u.result==!0))return u}return{value:null,result:!1}},n.prototype.getModelProperty=function(n,t){var s,i,u,f,e,r,h,o;if(t!=null){if(s=t,i=s.split("."),n==null&&i.length!=1)throw new NullReferenceException(i[0]);if(i[0].length>0){for(u in n)if(u==i[0])return(f=n[u],i.length==1)?{value:f,result:!0}:this.getModelProperty(f,i.slice(1).join("."));if(n.__locals!=undefined&&n.__locals!=null)for(e=n.__locals,r=e.length-1;r>=0;r--)if(h=e[r],o=this.getModelProperty(h,t),o.result==!0)return o}else return{value:n,result:!0}}return{value:null,result:!1}},n.prototype.getValueType=function(n){if(n!=null){var t=this.valueTypeProvider.getValue(n);return{property:t.value,type:t.type}}return{property:n,type:ValueType.keyword}},n}()
var ValueTypeResult=function(){function n(n,t){this.type=n,this.value=t}return n}(),ValueTypeProvider=function(){function n(){this.keywordHandlers=[],this.keywordHandlers["this"]=function(){return new ValueTypeResult(ValueType.local,"this")},this.keywordHandlers["false"]=function(){return new ValueTypeResult(ValueType.local,!1)},this.keywordHandlers["true"]=function(){return new ValueTypeResult(ValueType.local,!0)},this.keywordHandlers["null"]=function(){return new ValueTypeResult(ValueType.local,null)}}return n.prototype.getValue=function(n){var t=new ValueTypeResult(ValueType.stringLiteral,null);return n==null?t:(this.isWrappedInQuotes(n)?(t.type=ValueType.stringLiteral,t.value=n.substring(1,1+n.length-2)):this.keywordHandlers[n]!=null?t=this.keywordHandlers[n](n):(t.type=ValueType.property,t.value=n),t)},n.prototype.isWrappedInQuotes=function(n){return this.startsWith(n,'"')||this.startsWith(n,"'")},n.prototype.startsWith=function(n,t){return n.length>0&&n.charAt(0)==t},n}()
var Token=function(){function n(n,t,i){this.index=n,this.content=t,this.type=i}return n}()
var Tokenizer=function(){function n(n){this._source=n,this._currentIndex=0}return n.prototype.hasAvailableTokens=function(){return this._currentIndex<this._source.length},n.prototype.peek=function(){return this._source.charAt(this._currentIndex)},n.prototype.consume=function(){if(this._currentIndex>=this._source.length)throw new EndOfStreamException;var n=this._source.charAt(this._currentIndex);return this._currentIndex++,n},n.prototype.consumeIdentifier=function(){for(var t="",n=this.peek();this.isIdTail(n);)this.consume(),t+=n,n=this.peek();return t},n.prototype.consumeWhitespace=function(){for(var t="",n=this.peek();this.isWhitespace(n);)this.consume(),t+=n,n=this.peek();return t},n.prototype.consumeUntilNewLine=function(){for(var t="",n=this.peek();!this.isNewLine(n);)this.consume(),t+=n,n=this.peek();return t},n.prototype.consumeQuotedStringLiteral=function(n){for(var i=this.consume(),t=this.peek();t!=n;)this.consume(),i+=t,t=this.peek();return i+this.consume()},n.prototype.isNewLine=function(n){return n=="\r"||n=="\n"},n.prototype.getNextToken=function(){var n;if(this.hasAvailableTokens()){if(n=this.peek(),this.isIdentifierHead(n))return new IdentifierToken(this._currentIndex,this.consumeIdentifier(),TokenType.identifier);if(this.isWhitespace(n))return new WhitespaceToken(this._currentIndex,this.consumeWhitespace(),TokenType.whitespace);switch(n){case",":return this.consume(),new CommaToken(this._currentIndex);case"(":return this.consume(),new OpenParenthesisToken(this._currentIndex);case")":return this.consume(),new CloseParenthesisToken(this._currentIndex);case"[":return this.consume(),new OpenBracketToken(this._currentIndex);case"]":return this.consume(),new CloseBracketToken(this._currentIndex);case"=":return this.consume(),new EqualToken(this._currentIndex);case"{":return this.consume(),new OpenBracesToken(this._currentIndex);case"}":return this.consume(),new CloseBracesToken(this._currentIndex);case">":return this.consume(),new GreaterThanToken(this._currentIndex);case"+":return this.consume(),new PlusToken(this._currentIndex);case"|":return new StringLiteralPipeToken(this._currentIndex,this.consumeUntilNewLine());case'"':return new QuotedStringLiteralToken(this._currentIndex,this.consumeQuotedStringLiteral('"'));case"'":return new QuotedStringLiteralToken(this._currentIndex,this.consumeQuotedStringLiteral("'"));case"@":return this.consume(),new AtToken(this._currentIndex);case'\0':return null;default:throw new UnexpectedTokenException("Unexpected token: "+n);}}return null},n.prototype.isWhitespace=function(n){return n=="\r"||n=="\n"||n==" "||n=="\f"||n=="\t"||n=="\x0b"},n.prototype.isIdentifierHead=function(n){return n.match(/[a-zA-Z]/)||n=="_"||n=="#"||n=="."},n.prototype.isIdTail=function(n){return n.match(/[0-9]/)||this.isIdentifierHead(n)||n==":"||n=="-"},n.prototype.tokenize=function(){for(var n,t=[];(n=this.getNextToken())!=null;)t.push(n);return t},n.prototype.tokens=function(){return this.tokenize()},n}(),EndOfStreamException=function(){function n(){}return n}(),UnexpectedTokenException=function(){function n(n){this.message=n}return n}()
var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},AtToken=function(n){function t(t){n.call(this,t,"@",TokenType.at)}return __extends(t,n),t}(Token),QuotedStringLiteralToken=function(n){function t(t,i){n.call(this,t,i,TokenType.quotedStringLiteral)}return __extends(t,n),t}(Token),StringLiteralPipeToken=function(n){function t(t,i){n.call(this,t,i,TokenType.stringLiteralPipe)}return __extends(t,n),t}(Token),PlusToken=function(n){function t(t){n.call(this,t,"+",TokenType.plus)}return __extends(t,n),t}(Token),GreaterThanToken=function(n){function t(t){n.call(this,t,">",TokenType.greaterThan)}return __extends(t,n),t}(Token),CloseParenthesisToken=function(n){function t(t){n.call(this,t,")",TokenType.closeParenthesis)}return __extends(t,n),t}(Token),CloseBracesToken=function(n){function t(t){n.call(this,t,"}",TokenType.closeBrace)}return __extends(t,n),t}(Token),OpenBracesToken=function(n){function t(t){n.call(this,t,"{",TokenType.openBrace)}return __extends(t,n),t}(Token),EqualToken=function(n){function t(t){n.call(this,t,"=",TokenType.equal)}return __extends(t,n),t}(Token),CloseBracketToken=function(n){function t(t){n.call(this,t,"]",TokenType.closeBracket)}return __extends(t,n),t}(Token),OpenBracketToken=function(n){function t(t){n.call(this,t,"[",TokenType.openBracket)}return __extends(t,n),t}(Token),OpenParenthesisToken=function(n){function t(t){n.call(this,t,"(",TokenType.openParenthesis)}return __extends(t,n),t}(Token),CommaToken=function(n){function t(t){n.call(this,t,",",TokenType.comma)}return __extends(t,n),t}(Token),IdentifierToken=function(n){function t(t,i,r){n.call(this,t,i,r)}return __extends(t,n),t}(Token),WhitespaceToken=function(n){function t(t,i,r){n.call(this,t,i,r)}return __extends(t,n),t}(Token)
var TokenType;(function(n){n._map=[],n._map[0]="start",n.start=0,n._map[1]="identifier",n.identifier=1,n._map[2]="quotedStringLiteral",n.quotedStringLiteral=2,n._map[3]="stringLiteral",n.stringLiteral=3,n._map[4]="openBracket",n.openBracket=4,n._map[5]="closeBracket",n.closeBracket=5,n._map[6]="openParenthesis",n.openParenthesis=6,n._map[7]="closeParenthesis",n.closeParenthesis=7,n._map[8]="comma",n.comma=8,n._map[9]="openBrace",n.openBrace=9,n._map[10]="closeBrace",n.closeBrace=10,n._map[11]="greaterThan",n.greaterThan=11,n._map[12]="plus",n.plus=12,n._map[13]="whitespace",n.whitespace=13,n._map[14]="stringLiteralPipe",n.stringLiteralPipe=14,n._map[15]="commentLine",n.commentLine=15,n._map[16]="commentStart",n.commentStart=16,n._map[17]="commentEnd",n.commentEnd=17,n._map[18]="equal",n.equal=18,n._map[19]="at",n.at=19})(TokenType||(TokenType={}))
var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},ParrotDocument=function(){function n(){this.errors=[],this.children=[]}return n}(),Parser=function(){function n(){this.errors=[]}return n.prototype.parse=function(n){var t=new ParrotDocument,i=new Tokenizer(n),r=i.tokens(),u=new Stream(r),f=this;return this.parseStream(u,function(n){for(var i in n)f.parseStatementErrors(n[i]),t.children.push(n[i])}),t.errors=this.errors,console.log(t.children),t},n.prototype.parseStatementErrors=function(n){var i,t;if(n.errors.length>0)for(i in n.errors)t=n.errors[i],t.index+=n.index,this.errors.push(t)},n.prototype.parseStream=function(n,t){for(var i,r;n.peek()!=null;){i=n.peek();switch(i.type){case TokenType.stringLiteral:case TokenType.stringLiteralPipe:case TokenType.quotedStringLiteral:case TokenType.identifier:case TokenType.openBracket:case TokenType.openParenthesis:case TokenType.equal:case TokenType.at:r=this.parseStatement(n),t(r);break;default:this.errors.push(new UnexpectedToken(i)),n.next()}}},n.prototype.parseStatement=function(n){var r=n.peek(),s,t,h,i,f,e,u,o,c;if(r==null)return this.errors.push(new EndOfStream),[];s=r.type,t=null;switch(s){case TokenType.identifier:t=n.next();break;case TokenType.openBracket:case TokenType.openParenthesis:break;case TokenType.stringLiteral:case TokenType.stringLiteralPipe:case TokenType.quotedStringLiteral:t=n.next();break;case TokenType.at:n.nextNoReturn(),t=n.next();break;case TokenType.equal:n.nextNoReturn(),t=n.next();break;default:return this.errors.push(new UnexpectedToken(r)),[]}for(i=null,f=!1;n.peek()!=null&&!f;){if(e=n.peek(),e==null)break;switch(e.type){case TokenType.openParenthesis:case TokenType.openBracket:case TokenType.openBrace:i=this.parseStatementTail(n);break;case TokenType.greaterThan:n.nextNoReturn(),i=this.parseSingleStatementTail(n);break;default:this.getStatementFromToken(t,i,null),f=!0}}for(h=this.getStatementFromToken(t,i,r),u=[],u.push(h);n.peek()!=null;)if(n.peek().type==TokenType.plus){n.nextNoReturn(),o=this.parseStatement(n);for(c in o)u.push(o[c])}else break;return u},n.prototype.getStatementFromToken=function(n,t,i){var r=n!=null?n.content:"";if(n!=null)switch(n.type){case TokenType.stringLiteral:case TokenType.quotedStringLiteral:return new StringLiteral(r,t,n.index);case TokenType.stringLiteralPipe:return new StringLiteralPipe(r.substring(1),t,n.index)}if(i!=null)switch(i.type){case TokenType.at:return new EncodedOutput(r,null,i.index);case TokenType.equal:return new RawOutput(r,null,i.index)}return new Statement(r,t,n.index)},n.prototype.parseSingleStatementTail=function(n){var i=this.parseStatement(n),t=new StatementTail;return t.children=i,t},n.prototype.parseStatementTail=function(n){for(var t=new Array(3),r=!1,u,i;n.peek()!=null&&!r;){u=n.peek();switch(u.type){case TokenType.openParenthesis:t[1]=this.parseParameters(n);break;case TokenType.openBracket:t[0]=this.parseAttributes(n);break;case TokenType.greaterThan:t[2]=this.parseChild(n);break;case TokenType.openBrace:t[2]=this.parseChildren(n),r=!0;break;default:r=!0}}return i=new StatementTail,i.attributes=t[0],i.parameters=t[1],i.children=t[2],i},n.prototype.parseChild=function(n){var r=[],t,u,i,f;for(n.nextNoReturn(),t=!1;n.peek()!=null&&!t;){if(u=n.peek(),u==null)break;i=this.parseStatement(n);for(f in i)r.push(i[f]);t=!0}return r},n.prototype.parseChildren=function(n){var i=[],r,u,t,f;for(n.nextNoReturn(),r=!1;n.peek()!=null&&!r;){if(u=n.peek(),u==null)break;switch(u.type){case TokenType.plus:break;case TokenType.closeBrace:n.nextNoReturn(),r=!0;break;default:t=this.parseStatement(n),console.log("parseChildren:",t);for(f in t)i.push(t[f])}}return console.log("returning:",i),i},n.prototype.parseParameters=function(n){var i=[],r,t;for(n.nextNoReturn(),r=!1;n.peek()!=null&&!r;){if(t=n.peek(),t==null)break;switch(t.type){case TokenType.identifier:case TokenType.quotedStringLiteral:case TokenType.stringLiteralPipe:i.push(this.parseParameter(n));break;case TokenType.comma:n.nextNoReturn();break;case TokenType.closeParenthesis:n.nextNoReturn(),r=!0;break;default:return this.errors.push(new UnexpectedToken(t)),i}}return i},n.prototype.parseParameter=function(n){var t=n.next();switch(t.type){case TokenType.stringLiteralPipe:case TokenType.quotedStringLiteral:case TokenType.stringLiteral:case TokenType.identifier:break;default:return this.errors.push(new UnexpectedToken(t)),null}return new Parameter(t.content)},n.prototype.parseAttributes=function(n){for(var i=[],t=null,r=!1;n.peek()!=null&&!r;){if(t=n.peek(),t==null)break;switch(t.type){case TokenType.identifier:i.push(this.parseAttribute(n));break;case TokenType.closeBracket:n.nextNoReturn(),r=!0;break;default:return this.errors.push(new AttributeIdentifierMissing(t.index)),i}}},n.prototype.parseAttribute=function(n){var i=n.next(),u=n.peek(),r,t;if(u!=null&&u.type==TokenType.equal){if(n.nextNoReturn(),r=n.peek(),r==null)return this.errors.push(new UnexpectedToken(i)),new Attribute(i.content,null);if(r.type==TokenType.closeBracket&&this.errors.push(new AttributeValueMissing(r.index)),t=this.parseStatement(n)[0],t!=null)switch(t.name){case"true":case"false":case"null":t=new StringLiteral('"'+t.name+'"',null,0)}return new Attribute(i.content,t)}return new Attribute(i.content,null)},n}(),AttributeValueMissing=function(n){function t(t){n.call(this),this.index=t,this.message="Attribute must have a value"}return __extends(t,n),t}(ParserError),AttributeIdentifierMissing=function(n){function t(t){n.call(this),this.index=t,this.message="Invalid attribute name"}return __extends(t,n),t}(ParserError),EndOfStream=function(n){function t(){n.call(this),this.message="Unexpected end of file."}return __extends(t,n),t}(ParserError),UnexpectedToken=function(n){function t(t){n.call(this),this.type=t.type,this.token=t.content,this.index=t.index,this.message="Unexpected token: "+this.type}return __extends(t,n),t}(ParserError),Statement=function(){function n(n,t,i){this.index=i,this.parameters=[],this.attributes=[],this.children=[],this.identifierParts=[],this.errors=[];var r=this;this.indexOfAny(n,[".","#",":"])>-1?this.getIdentifierParts(n,function(n){var t;switch(n.type){case IdentifierType.id:n.name.length==0?r.errors.push(new MissingIdDeclaration(n.index-1,1)):r.anyAttributes(function(n){return n.key=="id"})?r.errors.push(new MultipleIdDeclarations(n.name,n.index-1,n.name.length+1)):(t=new StringLiteral('"'+n.name+'"',null,0),r.addAttribute(new Attribute("id",t)));break;case IdentifierType.class:n.name.length==0?r.errors.push(new MissingClassDeclaration(1,1)):(t=new StringLiteral('"'+n.name+'"',null,0),r.addAttribute(new Attribute("class",t)));break;case IdentifierType.type:t=new StringLiteral('"'+n.name+'"',null,0),r.addAttribute(new Attribute("type",t));break;case IdentifierType.literal:r.name=n.name}r.identifierParts.push(n)}):r.name=n,this.parseStatementTail(t)}return n.prototype.anyAttributes=function(n){for(var t in this.attributes)if(n(this.attributes[t]))return!0;return!1},n.prototype.parseStatementTail=function(n){if(n!=null){if(n.parameters!=null&&(this.parameters=n.parameters),n.attributes!=null){for(var t in this.attributes)n.attributes.push(this.attributes[t]);this.attributes=n.attributes}n.children!=null&&(this.children=n.children)}},n.prototype.addAttribute=function(n){this.attributes.push(n)},n.prototype.identifierTypeFromCharacter=function(n,t){switch(n){case":":return IdentifierType.type;case"#":return IdentifierType.id;case".":return IdentifierType.class}return t},n.prototype.getIdentifierParts=function(n,t){for(var r=0,e=IdentifierType.literal,f=IdentifierType.none,i,u=0;u<n.length;u++)f=this.identifierTypeFromCharacter(n.charAt(u),f),f!=IdentifierType.none&&(i=new Identifier,i.name=n.substring(r,r+(u-r)),i.type=e,i.index=r,i.length=u-r,t(i),r=u+1,e=f,f=IdentifierType.none);i=new Identifier,i.name=n.substring(r),i.type=e,i.index=r,t(i)},n.prototype.indexOfAny=function(n,t){var r,i;for(r in t)if(i=n.indexOf(t[r]),i!=-1)return i;return-1},n}(),MissingIdDeclaration=function(n){function t(t,i){n.call(this),this.index=t,this.length=i,this.message="Missing Id declaration"}return __extends(t,n),t}(ParserError),MissingClassDeclaration=function(n){function t(t,i){n.call(this),this.index=t,this.length=i,this.message="Missing Class declaration"}return __extends(t,n),t}(ParserError),MultipleIdDeclarations=function(n){function t(t,i,r){n.call(this),this.id=t,this.index=i,this.length=r,this.message="Element may not have more than one id"}return __extends(t,n),t}(ParserError),Parameter=function(){function n(n){this.value=n}return n}(),StatementTail=function(){function n(){}return n}(),Attribute=function(){function n(n,t){this.key=n,this.value=t}return n}(),Identifier=function(){function n(){}return n}(),IdentifierType,ValueType,StringLiteralPartType;(function(n){n._map=[],n._map[0]="id",n.id=0,n._map[1]="class",n.class=1,n._map[2]="literal",n.literal=2,n._map[3]="type",n.type=3,n._map[4]="none",n.none=4})(IdentifierType||(IdentifierType={})),function(n){n._map=[],n._map[0]="stringLiteral",n.stringLiteral=0,n._map[1]="property",n.property=1,n._map[2]="local",n.local=2,n._map[3]="keyword",n.keyword=3}(ValueType||(ValueType={})),function(n){n._map=[],n._map[0]="literal",n.literal=0,n._map[1]="encoded",n.encoded=1,n._map[2]="raw",n.raw=2}(StringLiteralPartType||(StringLiteralPartType={}));var StringLiteralPart=function(){function n(n,t,i){this.type=n,this.data=t,this.index=i,this.length=t.length}return n}(),StringLiteral=function(n){function t(t,i,r){n.call(this,"string",i,r),this.values=[],this.valueType=ValueType.stringLiteral,this.isWrappedInQuotes(t)?(this.valueType=ValueType.stringLiteral,t=t.substring(1,1+t.length-2)):this.valueType=t=="this"?ValueType.local:t=="null"||t=="true"||t=="false"?ValueType.keyword:ValueType.property,this.valueType==ValueType.stringLiteral&&(this.values=this.parse(t))}return __extends(t,n),t.prototype.startsWith=function(n,t){return n.length>0&&n.charAt(0)==t},t.prototype.isWrappedInQuotes=function(n){return this.startsWith(n,'"')||this.startsWith(n,"'")},t.prototype.parse=function(n){for(var f=[],i=0,u=new Array(n.length),e,o,r,t=0;t<n.length;t++)if(n.charAt(t)=="@"||n.charAt(t)=="=")if(e=n.charAt(t),o=e=="@"?StringLiteralPartType.encoded:StringLiteralPartType.raw,t++,n.charAt(Math.min(n.length-1,t))==e)u[i++]=e;else if(this.isIdentifierHead(n.charAt(t))){for(i>0&&f.push(new StringLiteralPart(StringLiteralPartType.literal,u.join(""),t-i)),i=0,r="";t<n.length;t++,i++){if(!this.isIdTail(n.charAt(t)))break;r+=n.charAt(t)}r.charAt(r.length-1)=="."?(r=r.substring(0,r.length-1),f.push(new StringLiteralPart(o,r,t-i)),i=0,u[i++]="."):(f.push(new StringLiteralPart(o,r,t-i)),i=0),t<n.length&&(u[i++]=n.charAt(t))}else u[i++]=e,t-=1;else u[i++]=n.charAt(t);return i>0&&f.push(new StringLiteralPart(StringLiteralPartType.literal,u.join(""),n.length-i)),f},t.prototype.isIdentifierHead=function(n){return n.match(/[a-zA-Z]/)||n=="_"||n=="#"||n=="."},t.prototype.isIdTail=function(n){return n.match(/[0-9]/)||this.isIdentifierHead(n)||n==":"||n=="-"},t}(Statement),StringLiteralPipe=function(n){function t(t,i,r){n.call(this,t,i,r)}return __extends(t,n),t}(StringLiteral),EncodedOutput=function(n){function t(t,i,r){n.call(this,'"@'+t+'"',i,r)}return __extends(t,n),t}(StringLiteral),RawOutput=function(n){function t(t,i,r){n.call(this,'"='+t+'"',i,r)}return __extends(t,n),t}(StringLiteral)
var ParserError=function(){function n(){}return n}()
var Stream=function(){function n(n){this._list=n,this._count=n.length,this._index=-1}return n.prototype.peek=function(){for(var n=this._index+1;n<this._count;){if(this._list[n].type!=TokenType.whitespace)return this._list[n];n++}return null},n.prototype.getNextNoReturn=function(){for(this._index++;this._index<this._count&&this._list[this._index].type==TokenType.whitespace;)this._index++},n.prototype.nextNoReturn=function(){this.getNextNoReturn()},n.prototype.next=function(){for(this._index++;this._index<this._count;){if(this._list[this._index].type!=TokenType.whitespace)return this._list[this._index];this._index++}return null},n}()
var ArgumentException=function(){function n(n){this.argument=n}return n}(),NullReferenceException=function(){function n(n){this.parameter=n}return n}()
var TagRenderMode,TagBuilder;(function(n){n._map=[],n._map[0]="startTag",n.startTag=0,n._map[1]="endTag",n.endTag=1,n._map[2]="selfClosing",n.selfClosing=2,n._map[3]="normal",n.normal=3})(TagRenderMode||(TagRenderMode={})),TagBuilder=function(){function n(n){this.name=n,this.innerHtml="",this.attributes=[]}return n.prototype.toString=function(n){switch(n){case TagRenderMode.startTag:return"<"+this.name+this.appendAttributes()+">";case TagRenderMode.endTag:return"<\/"+this.name+">";case TagRenderMode.selfClosing:return"<"+this.name+this.appendAttributes()+" />";default:return"<"+this.name+this.appendAttributes()+this.innerHtml+"<\/"+this.name+">"}},n.prototype.appendAttributes=function(){var r="",t;for(t in this.attributes){var u=this.attributes[t],i=t,n=u;(i!="id"||n!=null)&&n.length!=0&&(n=n!=null?this.htmlAttributeEncode(n):i,r+=" "+i+'="'+n+'"')}return r},n.prototype.htmlAttributeEncode=function(n){return n.replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace('"',"&quot;").replace("'","&#39;")},n.prototype.mergeAttribute=function(n,t,i){if(n==null||n.length==0)throw new ArgumentException("key");(i||!this.containsKey(this.attributes,n))&&(this.attributes[n]=t)},n.prototype.containsKey=function(n,t){for(var i in n)if(i==t)return!0;return!1},n.prototype.addCssClass=function(n){this.attributes["class"]=this.attributes["class"]!=undefined&&this.attributes["class"]!=null?n+" "+this.attributes["class"]:n},n}()
var BaseRenderer=function(){function n(){}return n.prototype.getlocal=function(){},n.prototype.getLocalModelValue=function(n,t,i){var u=new ObjectModelValueProvider,r;return t.parameters.length>0&&(r=u.getValue(n,i,null,t.parameters[0].value),r.result==!0)?r.value:i!=null&&(r=u.getValue(n,i,ValueType.property,null),r.result==!0)?r.value:i},n}()
var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},ConditionalRenderer=function(n){function t(){n.apply(this,arguments),this.defaultChildTag="div",this.elements=["conditional"]}return __extends(t,n),t.prototype.render=function(n,t,i,r){var e,o,f,u;this.rendererProvider=r,e=this.getLocalModelValue(t,n,i),o="default",e!=null&&(o=e.toString());for(f in n.children){var u=n.children[f],s="",h=r.getRenderer(u.name);if(s=h instanceof StringRenderer?h.render(u,t,i,r):u.name,s==o)return this.renderChildren(u,t,i,this.defaultChildTag);for(f in n.children)if(u=n.children[f],u.name=="default")return this.renderChildren(u,t,i,this.defaultChildTag)}},t}(HtmlRenderer)
var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},DocTypeRenderer=function(n){function t(){n.apply(this,arguments),this.defaultChildTag="div",this.elements=["doctype"]}return __extends(t,n),t.prototype.render=function(n,t,i){var r="html",u;return n.parameters.length>0&&(u=this.getLocalModelValue(t,n,i),r=u),"<!DOCTYPE "+r+">"},t}(BaseRenderer)
var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},ForEachRenderer=function(n){function t(){n.apply(this,arguments),this.defaultChildTag="li",this.elements=["foreach"]}return __extends(t,n),t.prototype.render=function(n,t,i,r){var o,u,f,e;if(this.rendererProvider=r,o=this.getLocalModelValue(t,n,i),Object.prototype.toString.call(i)==="[object Array]"){u="";for(f in i)e=new Locals(t),e.push(this.iteratorItem(f,i)),u+=this._renderChildren(n.children,t,i[f],this.defaultChildTag),e.pop();return u}return""},t.prototype.iteratorItem=function(n,t){return{_first:n==0,_last:n==t.length-1,_index:n,_even:n%2==0,_odd:n%2==1}},t}(HtmlRenderer)
var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},HtmlRenderer=function(n){function t(){n.apply(this,arguments),this.defaultChildTag="div",this.elements=["*"]}return __extends(t,n),t.prototype.render=function(n,t,i,r){this.rendererProvider=r;var u=this.getLocalModelValue(t,n,i);return console.log("rendering statement:",n.name),this.createTag(n,t,u)},t.prototype.createTag=function(n,t,i){var f=n.name==null?this.defaultChildTag:n.name,u=new TagBuilder(f),r;return this.renderAttributes(t,i,n,u),r="",r+=u.toString(TagRenderMode.startTag),n.children.length>0&&(r+=this.renderChildren(n,t,i,this.defaultChildTag)),r+u.toString(TagRenderMode.endTag)},t.prototype.renderAttribute=function(n,t,i){var r=new StringRenderer;return r.render(n.value,t,i,this.rendererProvider)},t.prototype.renderAttributes=function(n,t,i,r){var e,u,f;for(e in i.attributes)u=i.attributes[e],u.value==null?r.mergeAttribute(u.key,u.key,!0):(f=this.renderAttribute(u,n,t),u.key=="class"?r.addCssClass(f):r.mergeAttribute(u.key,f,!0))},t.prototype.renderChildren=function(n,t,i,r){var u,f;if((r==null||r.length==0)&&(r=this.defaultChildTag),Object.prototype.toString.call(i)==="[object Array]"){u="";for(f in i)u+=this._renderChildren(n.children,t,i[f],r);return u}return this._renderChildren(n.children,t,i,r)},t.prototype._renderChildren=function(n,t,i){var u="",f,r,e;for(f in n)r=n[f],e=this.rendererProvider.getRenderer(r.name),u+=e.render(r,t,i,this.rendererProvider);return u},t}(BaseRenderer)
var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},IfRenderer=function(n){function t(){n.apply(this,arguments),this.defaultChildTag="",this.elements=["if"]}return __extends(t,n),t.prototype.render=function(n,t,i,r){this.rendererProvider=r;var u=this.getLocalModelValue(t,n,i);if(u!=null&&u==!0)return this.renderChildren(n,t,i,this.defaultChildTag)},t}(HtmlRenderer)
var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},SelfClosingRenderer=function(n){function t(){n.apply(this,arguments),this.defaultChildTag="",this.elements=["base","basefont","frame","link","meta","area","br","col","hr","img","param"]}return __extends(t,n),t.prototype.render=function(n,t,i){var r=this.getLocalModelValue(t,n,i);return this.createTag(n,t,r)},t.prototype.createTag=function(n,t,i){var u=n.name==null||n.name.length==0?this.defaultChildTag:n.name,r=new TagBuilder(u);return this.renderAttributes(t,i,n,r),r.toString(TagRenderMode.selfClosing)},t}(HtmlRenderer)
var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},InputRenderer=function(n){function t(){n.apply(this,arguments),this.defaultChildTag="",this.elements=["input"]}return __extends(t,n),t.prototype.render=function(t,i,r,u){var s=this.getType(t,i,r),f,e,o;switch(s){case"checkbox":case"radio":for(f=0;f<t.attributes.length;f++)if(e=t.attributes[f],e.key=="checked"){o=this.renderAttribute(e,i,r);switch(o){case"true":t.attributes[f]=new Attribute(e.key,new StringLiteral('"checked"',null,0));break;case"false":case"null":t.attributes.splice(f,1),f-=1}}}return n.prototype.render.call(this,t,i,r,u)},t.prototype.getType=function(n,t,i){for(var u,r=0;r<n.attributes.length;r++)if(u=n.attributes[r],u.key=="type")return this.renderAttribute(u,t,i);return"hidden"},t}(SelfClosingRenderer)
var StringRenderer=function(){function n(){this.defaultChildTag="",this.elements=["string"]}return n.prototype.render=function(n,t,i,r){var u,f,e;if(this.rendererProvider=r,u="",n instanceof StringLiteral){f=n.values;for(e in f)u+=this.getModelValue(t,i,f[e].type,f[e].data)}else u=this.getModelValue(t,i,StringLiteralPartType.encoded,n.name);return u},n.prototype.getModelValue=function(n,t,i,r){var f=new ObjectModelValueProvider,u=f.getValue(n,t,null,r);if(u.result==!0)switch(i){case StringLiteralPartType.encoded:return encodeURI(u.value);case StringLiteralPartType.raw:return u.value}return r},n}()
var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},ListRenderer=function(n){function t(){n.apply(this,arguments),this.defaultChildTag="li",this.elements=["ul","ol"]}return __extends(t,n),t.prototype.renderChildren=function(n,t,i,r){var u,f,e;if(console.log("rendering children: list renderer"),(r==null||r.length==0)&&(r=this.defaultChildTag),Object.prototype.toString.call(i)==="[object Array]"){u="";for(f in i)e=new Locals(t),e.push(this.iteratorItem(f,i)),u+=this._renderChildren(n.children,t,i[f],r),e.pop();return u}return this._renderChildren(n.children,t,i,r)},t.prototype.iteratorItem=function(n,t){return{_first:n==0,_last:n==t.length-1,_index:n,_even:n%2==0,_odd:n%2==1}},t}(HtmlRenderer)
var RendererProvider=function(){function n(){this.renderers=[],this.renderers.push(new HtmlRenderer),this.renderers.push(new StringRenderer),this.renderers.push(new SelfClosingRenderer),this.renderers.push(new DocTypeRenderer),this.renderers.push(new ListRenderer)}return n.prototype.getRenderer=function(n){var t,i;for(t in this.renderers)for(i in this.renderers[t].elements)if(n==this.renderers[t].elements[i])return this.renderers[t];return this.getRenderer("*")},n}()
var ParrotDocumentView=function(){function n(n){this.parrotDocument=n,this.rendererProvider=new RendererProvider}return n.prototype.render=function(n,t){var r="",u,i,f;console.log("rendering document");for(u in this.parrotDocument.children)i=this.parrotDocument.children[u],f=this.rendererProvider.getRenderer(i.name),r+=f.render(i,n,t,this.rendererProvider);return r},n}()
